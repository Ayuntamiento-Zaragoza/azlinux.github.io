import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{r,o as l,c as d,a,b as e,d as i,e as t,f as s}from"./app-fdb4e109.js";const c={},m={href:"https://www.opensuse.org/",target:"_blank",rel:"noopener noreferrer"},u=a("em",null,"Live CD",-1),p=a("em",null,"USB stick",-1),b=a("em",null,"VMWare virtual machine",-1),v={href:"https://en.opensuse.org/Portal:Kiwi",target:"_blank",rel:"noopener noreferrer"},h={href:"https://studioexpress.opensuse.org/",target:"_blank",rel:"noopener noreferrer"},g={href:"https://old-en.opensuse.org/Derivatives",target:"_blank",rel:"noopener noreferrer"},f=s(`<p>Para empezar, vamos a comentar los cambios que queremos hacer sobre la distribución base:</p><ul><li>En el sistema de arranque: <ul><li>Cambiar el idioma (por defecto muestra el inglés y lo queremos cambiar a español).</li><li>Cambiar el fondo gráfico.</li></ul></li><li>En el sistema operativo: <ul><li>Cambiar el idioma (a español).</li><li>Cambiar la configuración del teclado.</li><li>Mostrar otro fondo de escritorio en la sesión gráfica del usuario.</li><li>Desactivar las actualizaciones automáticas (ya que el sistema es de sólo lectura).</li></ul></li></ul><h2 id="que-hay-dentro-de-una-imagen-iso-de-opensuse" tabindex="-1"><a class="header-anchor" href="#que-hay-dentro-de-una-imagen-iso-de-opensuse" aria-hidden="true">#</a> Qué hay dentro de una imagen ISO de openSUSE</h2><p>El primer paso, después de bajar la imagen ISO de openSUSE para Live CD (la 11.2), es descomprimir el fichero. Dicho archivo contiene los ficheros del sistema de arranque y un gran archivo que contiene el sistema de ficheros de la distribución. Este archivo, que necesitamos descomprimir para modificar ciertos parámetros del sistema, está en formato <em>clicfs</em> y dentro contiene otro fichero, llamado <code>fsdata.ext3</code>, que deberemos montar para acceder a los archivos reales. Necesitaremos tener instalado el paquete clicfs para descomprimir dicho formato.</p><p>Resumiendo, para realizar las operaciones descritas, las órdenes a ejecutar serían:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> /tmp/iso
<span class="token function">cp</span> /ruta/a/openSUSE-11.2-GNOME-LiveCD-i686.iso /tmp/iso
<span class="token builtin class-name">cd</span> /tmp/iso
file-roller --extract-here openSUSE-11.2-GNOME-LiveCD-i686.iso
<span class="token function">mkdir</span> /tmp/clicfs
<span class="token function">cp</span> /tmp/iso/openSUSE-11.2-GNOME-LiveCD-i686/openSUSE-gnome-11.2-live-gnome-read-only.i686-2.8.0 /tmp/clicfs
<span class="token builtin class-name">cd</span> /tmp/clicfs
unclicfs openSUSE-gnome-11.2-live-gnome-read-only.i686-2.8.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>El fichero <code>fsdata.ext3</code> que aparece al descomprimir el contenedor <em>clicfs</em>, no tiene espacio libre. Esto significa que no se podrá modificar ningún fichero porque no hay espacio disponible para hacer una copia temporal. La solución es dar algo de espacio libre. Habrá que redimensionar el sistema de archivos:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /tmp/clicfs
e2fsck <span class="token parameter variable">-f</span> fsdata.ext3
resize2fs fsdata.ext3 3800M
<span class="token function">mount</span> <span class="token parameter variable">-o</span> loop fsdata.ext3 /mnt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Con esto, dentro del directorio <code>/mnt</code> tendremos, en modo lectura y escritura, el sistema de ficheros de la distribución para poderlo modificar.</p><h2 id="cambio-de-idioma-teclado-fondo-de-escritorio-y-actualizaciones-automaticas" tabindex="-1"><a class="header-anchor" href="#cambio-de-idioma-teclado-fondo-de-escritorio-y-actualizaciones-automaticas" aria-hidden="true">#</a> Cambio de idioma, teclado, fondo de escritorio y actualizaciones automáticas</h2><p>Para cambiar el idioma a español, habrá que editar el fichero <code>/mnt/etc/sysconfig/language</code> (como usuario <code>root</code>) y modificar la variable <code>RC_LANG</code>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>RC_LANG=&quot;es_ES.UTF-8&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Si se quiere cambiar también el idioma para el usuario <code>root</code>, se debe actualizar el valor de la variable <code>ROOT_USES_LANG</code>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ROOT_USES_LANG=&quot;yes&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Ya que hemos cambiado el idioma, también es recomendable cambiar el mapeo del teclado. En este caso, hay que editar el fichero <code>/mnt/etc/sysconfig/keyboard</code> y modificar la variable <code>KEYTABLE</code> (como usuario <code>root</code>):</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>KEYTABLE=&quot;es.map.gz&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>El fondo de escritorio por defecto, se encuentra en el archivo <code>/mnt/usr/share/wallpapers/openSUSE112-1600x1200.png</code>, por lo que podemos cambiarla por otra fotografía que respete las dimensiones y formato del original.</p><p>Para desactivar las actualizaciones automáticas, es necesario crear el fichero <code>/mnt/etc/sysconfig/automatic_online_update</code>, con el siguiente contenido:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>AOU_ENABLE_CRONJOB=&quot;false&quot;
AOU_SKIP_INTERACTIVE_PATCHES=&quot;false&quot;
AOU_AUTO_AGREE_WITH_LICENSES=&quot;false&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Una vez hechos los cambios, si desmontamos el directorio <code>/mnt</code>, dentro del fichero <code>/tmp/clicfs/fsdata.ext3</code> estarán conservadas nuestras modificaciones. Tan sólo tenemos que recomprimir el fichero en formato <em>clicfs</em> y dejarlo en la ubicación original para completar esta fase del trabajo:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>umount /mnt
mkclicfs -c 9 fsdata.ext3 openSUSE-gnome-11.2-livecd-gnome-read-only.i686-2.8.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Le aplicamos el máximo nivel de compresión (el 9) para conseguir que quepa en un CD de 700 MB. Sólo hay que copiarlo en la ubicación original para luego rehacer la imagen ISO:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>cp /tmp/clicfs/openSUSE-gnome-11.2-livecd-gnome-read-only.i686-2.8.0 /tmp/iso/openSUSE-11.2-GNOME-LiveCD-i686/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="cambios-en-el-sistema-de-arranque" tabindex="-1"><a class="header-anchor" href="#cambios-en-el-sistema-de-arranque" aria-hidden="true">#</a> Cambios en el sistema de arranque</h2>`,24),S={href:"https://en.opensuse.org/SDB:Gfxboot",target:"_blank",rel:"noopener noreferrer"},_=s(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>gfxboot <span class="token parameter variable">-a</span> /tmp/iso/openSUSE-11.2-GNOME-LiveCD-i686/boot/i386/loader --add-language es_ES --default-language es_ES <span class="token parameter variable">-b</span> isolinux
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Esto hace que cambie el contenido del fichero <code>boot/loader/i386/loader/bootlogo</code>. A su vez, este archivo contiene otro, llamado <code>init</code>, que es donde se realizan dichos cambios.</p><p>Por último, para cambiar la imagen de fondo del arranque, copiaremos la nueva foto en el directorio <code>/tmp/iso/openSUSE-11.2-GNOME-LiveCD-i686/boot/i386/loader</code> con los nombres <code>back.jpg</code> y <code>welcome.jpg</code>. Eso sí, la nueva foto deberá mantener el mismo formato y dimensiones que las originales. Después, ejecutaremos este comando:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>gfxboot <span class="token parameter variable">-a</span> /tmp/iso/openSUSE-11.2-GNOME-LiveCD-i686/boot/i386/loader --add-files /tmp/iso/openSUSE-11.2-GNOME-LiveCD-i686/boot/i386/loader/back.jpg <span class="token parameter variable">-b</span> isolinux
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="rehacer-la-imagen-iso" tabindex="-1"><a class="header-anchor" href="#rehacer-la-imagen-iso" aria-hidden="true">#</a> Rehacer la imagen ISO</h2><p>Con el comando <code>mkisofs</code> podremos compilar los ficheros para obtener de nuevo una imagen ISO para poder planchar en un CD. Este comando tiene múltiples argumentos, pero sólo usaremos algunos de ellos.</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /tmp/iso/openSUSE-11.2-GNOME-LiveCD-i686
<span class="token function">mkisofs</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-l</span> <span class="token parameter variable">-o</span> /tmp/Nueva-Live-CD.iso <span class="token parameter variable">-b</span> boot/i386/loader/isolinux.bin <span class="token parameter variable">-c</span> boot.cat -no-emul-boot -boot-load-size <span class="token number">4</span> -boot-info-table <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>El punto del final del comando se refiere al directorio actual, lo que significa que hará una ISO con todo lo que haya en dicho directorio. Habrá que revisar el directorio y dejar sólamente lo estrictamente necesario antes de empaquetar la imagen ISO.</p><h2 id="convertir-en-una-imagen-live-usb" tabindex="-1"><a class="header-anchor" href="#convertir-en-una-imagen-live-usb" aria-hidden="true">#</a> Convertir en una imagen Live USB</h2><p>Aunque el resultado que se puede conseguir no es el de una imagen <em>Live USB</em> total, porque sólo se podrá escribir con persistencia en la partición de <code>home</code>, puede venir bien para aprovechar el trabajo y matar dos pájaros de un tiro (una misma imagen para dispositivos diferentes: CD y USB).</p><p>Lo primero es conseguir que la imagen ISO también sea capaz de arrancar en un dispositivo USB. Para ello, existe un comando, llamado <code>isohybrid</code> (dentro del paquete <code>syslinux</code>), que hará esta parte del proceso. Sin embargo, la documentación sobre el comando es bastante escasa. No basta con ejecutar el comando y pasar la ruta de la imagen ISO como parámetro para conseguir el objetivo. Es necesario que el identificador del sistema de arranque sea el mismo que espera la imagen ISO como dispositivo de arranque. Dicha información se halla en el fichero <code>/tmp/iso/openSUSE-11.2-GNOME-LiveCD-i686/boot/grub/mbrid</code>.</p><p>A falta de documentación sobre este tema, la solución se encuentra dentro del fichero <code>/usr/share/kiwi/modules/KIWIIsoLinux.pm</code>, que forma parte del paquete <strong>kiwi</strong> de openSUSE. Una vez que sabemos el identificador del MBR que espera encontrar la imagen ISO, la orden que debemos ejecutar es la siguiente:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>isohybrid <span class="token parameter variable">-id</span> 0x6de64dcf <span class="token parameter variable">-type</span> 0x83 /tmp/Nueva-Live-CD.iso
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Esta nueva imagen ISO ya se puede planchar en un dispositivo USB con, por ejemplo, el comando <code>dd</code>, o el comando <code>imagewriter</code> (que pertenece al paquete <code>kiwi-tools-imagewriter</code>).</p>`,14),q=a("code",null,"home",-1),E=a("code",null,"fdisk",-1),x={href:"https://en.opensuse.org/SDB:Live_USB_stick",target:"_blank",rel:"noopener noreferrer"},k=a("h2",{id:"referencias",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#referencias","aria-hidden":"true"},"#"),e(" Referencias")],-1),y={href:"https://old-en.opensuse.org/SuSE_install_from_USB_drive",target:"_blank",rel:"noopener noreferrer"},U=a("h2",{id:"actualizacion-2010-03-30",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#actualizacion-2010-03-30","aria-hidden":"true"},"#"),e(" Actualización 2010-03-30")],-1),C=a("p",null,[e("Si se resiste la desactivación de la actualización automática, es recomendable borrar el fichero "),a("code",null,"/mnt/etc/xdg/autostart/gpk-update-icon.desktop"),e(", para evitar que se lance el proceso en el inicio de la sesión gráfica.")],-1);function L(O,N){const o=r("ExternalLinkIcon");return l(),d("div",null,[a("p",null,[a("a",m,[e("openSUSE"),i(o)]),e(" proporciona una herramienta para construir distribuciones personalizadas basadas en su producto y que también permite que estén disponibles en diferentes formatos ("),u,e(", "),p,e(", "),b,e("...). El programa que posibilita todo esto se llama "),a("a",v,[e("kiwi"),i(o)]),e(" y se puede probar toda versatilidad y potencia dentro del "),a("a",h,[e("proyecto suseStudio"),i(o)]),e(".")]),t(" more "),a("p",null,[e("Sin embargo, para hacer unos cambios rápidos sobre la versión "),a("a",g,[e("Live CD oficial de openSUSE"),i(o)]),e(" no es necesario usar esa aplicación. A continuación explicaremos los pasos seguidos para realizar una personalización rápida.")]),f,a("p",null,[e("Para cambiar el idioma en el que se presenta el gestor de arranque de la imagen ISO, lo haremos con el comando "),a("a",S,[e("gfxboot"),i(o)]),e(".")]),_,a("p",null,[e("La segunda parte del proceso se reduce a aprovechar el espacio restante en el USB como partición de "),q,e(", en la que se pueda leer y escribir y obtener así persistencia. Dicho proceso lo podemos llevar a cabo con el comando "),E,e(". En la "),a("a",x,[e("página Live USB stick"),i(o)]),e(" se puede obtener más información sobre el tema.")]),k,a("ul",null,[a("li",null,[a("a",y,[e("SuSE install from USB drive"),i(o)])])]),U,C])}const I=n(c,[["render",L],["__file","2010-03-23-como-modificar-live-cd.html.vue"]]);export{I as default};
